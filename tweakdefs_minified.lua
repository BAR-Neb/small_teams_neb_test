local a,b,c,d;local e={2,4,5,8,12,20,50,125,250}local f,g=20,30;local function h(i,...)for j,k in ipairs({...})do i[k]=d[k]end end;local function l(m,n)if n then m=m/n else n=1 end;if m<=30 then return math.floor(m+0.5)*n end;local o={}for j,p in ipairs(e)do o[p]=math.floor(m/p+0.5)*p end;local q=o[e[1]]local r=q-m;r=r*r/e[1]for s=2,#e do local t=e[s]local u=o[t]-m;u=u*u/e[s]if r>u then q=o[t]r=u end end;return q*n end;local function v(w,x,y,z)if not x then x=0 end;if not y then y=x*(a.metalcost and a.metalcost>0 and a.energycost/a.metalcost or f)end;if not z then z=x*(a.metalcost and a.metalcost>0 and a.buildtime/a.metalcost or g)end;local A=l(a.metalcost*w+x,10)local B=A/a.metalcost;a.metalcost=A;a.energycost=l(a.energycost*w+y,10)a.buildtime=l(a.buildtime*w+z,10)for C,i in pairs(a.featuredefs or{})do i.metal=math.floor(B*i.metal+0.5)end end;local function D(w,E)if not E then E=0 end;for F,m in pairs(b.damage)do b.damage[F]=l(m*w+E)end end;local function G(C)a=UnitDefs[C]return a end;local function H(C)b=a.weapondefs[C]return b end;local function I(i)c=i.customparams or{}i.customparams=c;return c end;for j,C in ipairs{"armcom","corcom","legcom"}do G(C)a.airsightdistance=l(a.sightdistance*1.5)a.cloakcost=l(a.cloakcost*0.7)a.cloakcostmoving=l(a.cloakcostmoving*0.7)end;local J={"armwar","armjanus","armroy","armcir","armamex","corthud","cormist","corroy","corerad","corexp"}for C,i in pairs(UnitDefs)do if I(i).techlevel==1.5 then J[#J+1]=C end end;for j,C in ipairs(J)do I(G(C)).techlevel=1.5;c.paralyzemultiplier=0.7 end;I(G("corroach")).techlevel=1;for C,i in ipairs(UnitDefs)do if(I(i).techlevel or 1)<1.5 then if i.extractsmetal and i.extractsmetal>0 then i.health=l(G(C).health*2,25)elseif i.windgenerator and i.windgenerator>0 then i.health=l(G(C).health*1.1,25)elseif c.solar and(i.energyupkeep and i.energyupkeep<-50)or i.energymake and i.energymake>50 then i.health=l(G(C).health*1.125,25)i.energystorage=l((i.energystorage or 0)*1.125)elseif next(i.buildoptions)and string.find(i.movementclass or"","BOT")then i.health=l(G(C).health*1.12,25)end end end;G("armpw")v(1,0,0,132)a.speed=l(a.speed*1.08)G("armflash")a.speed=l(a.speed*1.08)G("armkam")H("emg")b.sprayangle=l(b.sprayangle*0.6)b.weaponvelocity=l(b.weaponvelocity*1.1)b.firetolerance=3600;G("corlevlr")a.speed=l(a.speed*1.1)H("corlevlr_weapon")b.range=l(b.range*0.92)for C,K in pairs{armrl="armrl_missile",armcir="arm_cir",corrl="corrl_missile",corerad="cor_erad",legrl="legrl_missile",legrhapsis="burst_aa_missile"}do G(C)a.weapons[1].fastautoretargeting=true;a.weapons[1].onlytargetcategory="NOTSUB"H(K)local L=(b.burst or 1)*(b.projectiles or 1)b.damage.default=l((20+0.2*b.damage.vtol*L)/L)end;for j,C in ipairs{"armmoho","cormoho","cormexp","legmoho","legmoho","legmohobp","legmohocon"}do G(C)v(1,100,2000,900)end;for C,i in pairs(UnitDefs)do if I(i).techlevel==2 then i.buildtime=l(G(C).buildtime*1.5)elseif c.techlevel==3 then i.buildtime=l(G(C).buildtime*2)end end;for j,C in ipairs{"armageo","corageo","legageo"}do G(C)v(1,100,4000,0)end;for j,M in ipairs{"arm","cor","leg"}do for j,N in ipairs{"lab","vp","ap","sy"}do if G(M..N)then v(0.5,300,900,4000)a.workertime=l(a.workertime*2.5,50)end end;for j,N in ipairs{"plat","amsub","amphlab"}do if G(M..N)then a.workertime=l(a.workertime*3+100,50)end end;for j,N in ipairs{"alab","avp","aap","asy"}do if G(M..N)then v(1,-500,2000,5000)a.workertime=l(a.workertime*5)end end;for j,N in ipairs{"gant","gantuw","shltx","shltxuw"}do if G(M..N)then v(1.5,1000,10000,2000)a.workertime=l(a.workertime*7.5,500)end end;for j,O in ipairs{"nanotc","nanotcplat"}do if G(M..O)then v(1,50,500,1000)a.metalstorage=50;a.energystorage=50;if M=="cor"then a.health=l(a.health*1.125,25)end end end end;G("armwar")v(1.2,0,0,300)a.health=l(a.health*1.25,25)a.idleautoheal=10;a.speed=l(a.speed*1.3333)H("armwar_laser")b.range=l(b.range-30)D(1.25)G("armjanus")v(1.3333)a.health=l(a.health*1.1667,25)a.speed=l(a.speed*1.125)H("janus_rocket")b.reloadtime=b.reloadtime*0.925;G("armamex")v(1.125)a.health=l(a.health*1.25,25)a.explodeas="mediumBuildingExplosionGeneric"a.energymake=a.cloakcost;a.radardistance=1000;a.radaremitheight=24;a.sightdistance=200;G("corthud")v(2)a.health=l(a.health*2,25)a.speed=l(a.speed*1.1667)a.turnrate=a.turnrate*1.05;H("arm_ham")b.areaofeffect=l(b.areaofeffect*1.1667)b.burst=2;b.burstrate=0.25;b.reloadtime=b.reloadtime*1.5;G("cormist")v(2)a.health=l(a.health*1.3333,25)for j,K in ipairs{"cortruck_aa","cortruck_missile"}do H(K)b.areaofeffect=UnitDefs.corstorm.weapondefs.cor_bot_rocket.areaofeffect+2;b.burst=3;b.burstrate=0.375;b.reloadtime=b.reloadtime*2 end;G("corexp")v(1.5)a.health=l(a.health*1.3333,25)a.idleautoheal=10;a.sightdistance=l(a.sightdistance*1.5)b=a.weapondefs.hllt_bottom;b.range=l(b.range+50)D(1.125)G("corak")v(0.8888)a.health=l(a.health*0.8888,25)b=a.weapondefs.gator_laser;b.range=l(b.range*1.05)G("corroach")v(0.5,0,-2000,-2000)a.maxwaterdepth=16;a.movementclass="BOT1"a.radardistance=UnitDefs.armflea.sightdistance+30;a.radaremitheight=18;a.speed=l(a.speed*1.3333)a.explodeas="mediumExplosionGenericSelfd"a.selfdestructas="fb_blastsml"a.customparams.techlevel=nil;for C,i in ipairs(UnitDefs)do if i.builder and type(i.buildoptions)=="table"then for s,P in pairs(i.buildoptions)do if P=="corroach"then G(C)table.remove(i.buildoptions,s)end end end end;G("corlab")a.buildoptions[#a.buildoptions+1]="corroach"d=UnitDefs.armkam.weapondefs.emg;for C,K in pairs{armwar="armwar_laser",armhlt="arm_laserh1"}do G(C)H(K).name="Heavy EMG"h(b,"weapontype","corethickness","explosiongenerator","intensity","laserflaresize","rgbcolor","thickness","size","soundhitwet","soundstart","burstrate","beamburst","beamtime","cylindertargeting","energypershot","impactonly","tolerance","predictboost","weaponvelocity")b.impulsefactor=0.8;D((b.burst or 1)/(d.burst+1))b.burst=d.burst+1;local B=d.reloadtime/b.reloadtime*d.range/b.range;b.sprayangle=d.sprayangle*math.sqrt(B)end;d=UnitDefs.armmav.weapondefs.armmav_weapon;for C,K in pairs{armham="arm_ham"}do G(C)v(1.1)H(K).name="Gauss Plasma Cannon"h(b,'impulsefactor','weaponvelocity')b.reloadtime=l(b.reloadtime*1.75,0.01)D(1.75)end;for C,K in pairs{cormist="cortruck_missile",corstorm="cor_bot_rocket"}do G(C)H(K).name="Light Solid-Fuel Rocket"b.model="legsmallrocket.s3o"b.burnblow=false;b.mygravity=0;b.tracks=true;b.trajectoryheight=0.25;b.turnrate=8000;b.startvelocity=a.speed+1;b.weaponvelocity=l(b.weaponvelocity*2.2)b.weaponacceleration=b.weaponvelocity-b.startvelocity;local Q=(b.weaponvelocity-b.startvelocity)/b.weaponacceleration;local R=math.min(b.range,Q*(b.startvelocity+b.weaponvelocity)*0.5)b.flighttime=Q+(b.range-R)*0.9/b.weaponvelocity;b.dance=6;b.wobble=600;I(b).overrange_distance=b.range;c.place_target_on_ground=true;c.projectile_destruction_method="descend"end